!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";class t{constructor(t,e=6,i=null){this.alertsDelay=e,this.alertsAnimation=.3,this.alertsTimeout,this.alertsTimeoutDestroy,this.text=i,this.nativeElement=t,this.init()}init(){this.text&&this.create(),this.nativeElement.classList.add("showing"),this.nativeElement.style.transitionDuration=this.alertsAnimation+"s",this.nativeElement.addEventListener("click",function(t){this.destroy()}.bind(this)),this.alertsTimeout&&clearTimeout(this.alertsTimeout),this.alertsTimeout=setTimeout((()=>{this.destroy()}),1e3*this.alertsDelay)}create(){let t=document.querySelector("#wrapper .container"),e=document.createElement("div");if(e.classList.add("alert","position-fixed","auto"),this.text.length>1){let t=document.createElement("ul");this.text.forEach((e=>{let i=document.createElement("p"),s=document.createElement("li"),a=document.createTextNode(e);i.appendChild(a),s.appendChild(i),t.appendChild(s)})),e.appendChild(t)}else{let t=document.createTextNode(this.text);e.appendChild(t)}t.appendChild(e),this.nativeElement=e}destroy(){this.nativeElement.classList.remove("showing"),this.alertsTimeoutDestroy&&clearTimeout(this.alertsTimeoutDestroy),this.alertsTimeoutDestroy=setTimeout((()=>{this.nativeElement.remove()}),1e3*this.alertsAnimation)}}class e{constructor(t){this.MSG_DRAG="Datei rein ziehen",this.MSG_DROP="Los lassen",this.MSG_WARNING="Maximal 1 Datei erlaubt",this.MSG_ERROR="Dateityp nicht erlaubt: .",this.MSG_ALLOWED_TYPES="Erlaubte Dateien: ",this.nativeElement=t,this.dragArea=this.nativeElement.querySelector(".drag-area"),this.dropArea=this.nativeElement.querySelector(".drop-area"),this.mediaContainer=this.dragArea.querySelector(".media-container"),this.dragText=this.dragArea.querySelector("header"),this.input=this.dragArea.querySelector("input"),this.submit=this.nativeElement.querySelector('button[type="submit"]'),this.extensions=this.input.getAttribute("accept"),this.fileType=this.nativeElement.id,this.file,this.init()}init(){this.submit.disabled=!0,this.submit.addEventListener("click",function(t){t.preventDefault(),fileUpload(t)}.bind(this)),this.input.addEventListener("change",function(t){this.file=t.target.files[0],this.dropArea.classList.add("active"),this.showFile()}.bind(this)),this.dragArea.addEventListener("dragover",function(t){t.preventDefault(),this.dropArea.classList.add("active"),this.dragText.textContent=this.MSG_DROP}.bind(this)),this.dragArea.addEventListener("dragleave",function(t){this.dropArea.classList.remove("active"),this.dragText.textContent=this.MSG_DRAG}.bind(this)),this.dragArea.addEventListener("drop",function(e){e.preventDefault(),this.dragText.textContent=this.MSG_DRAG,this.dropArea.classList.remove("active"),e.dataTransfer.files.length>1?new t(null,3,[this.MSG_WARNING]):(this.file=e.dataTransfer.files[0],this.input.files=e.dataTransfer.files,this.showFile())}.bind(this))}showFile(){let e=this.file.name.split(".").pop().toLowerCase();if(this.extensions.replaceAll(" ","").replaceAll(".","").split(",").includes(e)){this.submit.disabled=!1;let t=new FileReader;t.onload=()=>{t.result,"exhibit_preview"==this.fileType||"threed_model"==this.fileType||this.fileType,this.submit.click()},t.readAsDataURL(this.file)}else new t(null,10,[this.MSG_ERROR+e,this.MSG_ALLOWED_TYPES+this.extensions]),this.dropArea.classList.remove("active"),this.dragText.textContent=this.MSG_DRAG}}class i{constructor(t,e=!0){this.formInitialized=!1,this.formDisabled=!1,this.nativeElement=t,this.submit=this.nativeElement.querySelector('button[type="submit"]'),this.reset=this.nativeElement.querySelector('button.btn-reset[type="button"]'),this.hasWatchdog=e,this.formChanged=!1,this.jsonPopulatesIndex=0,this.formsMap=new Map,this.selectGroups=new Map,this.selectGroupsValues=new Map,this.selects=[],this.alwaysDisabledOptions=[],this.formEls,this.virtualSelectConf={placeholder:"Bitte wählen",noOptionsText:"Keine Optionen",noSearchResultsText:"Keine Ergebnisse",searchPlaceholderText:"Suchen...",allOptionsSelectedText:"Alle",optionsSelectedText:"ausgewählt",optionSelectedText:"ausgewählt",moreText:"mehr...",emptyValue:"",search:!0,disableSelectAll:!0,silentInitialValueSet:!0,autoSelectFirstOption:!1,disableOptionGroupCheckbox:!0},this.init()}init(){this.submit.disabled=!0,this.reset&&(this.reset.disabled=!0),this.initRegularSelects(),this.initJsonPopulators(),this.selects=this.nativeElement.querySelectorAll(".select-has-group"),this.selects.forEach((t=>{t.addEventListener("change",this.onSelectChange.bind(this.nativeElement))})),this.nativeElement.selects=this.selects,this.nativeElement.virtualSelectConf=this.virtualSelectConf}initSelectGroupWatchdog(){console.log("init form groups"),this.selects.forEach((t=>{this.setSelectedOptions(t)})),this.selects.forEach((t=>{t.permaDisabledOptions=[];let e=t.getDisabledOptions(),i=t.getAttribute("data-select-group"),s=this.selectGroupsValues.get(i);e.forEach((e=>{s.indexOf(e)<0&&t.permaDisabledOptions.push(e)})),this.alwaysDisabledOptions=t.permaDisabledOptions}))}onSelectChange(t){let e=t.target.getAttribute("data-select-group");this.selectGroups.set(e,""),this.selects.forEach((t=>{this.setSelectedOptions(t)})),this.selects.forEach((t=>{this.setDisabledOptions(t)}))}setSelectedOptions(t){let e=t.getAttribute("data-select-group"),i=this.selectGroups.get(e),s=this.selectGroupsValues.get(e);i&&i.length>0?(this.selectGroups.set(e,i.concat([t.getSelectedOptions()])),this.selectGroupsValues.set(e,s.concat([t.value]))):(this.selectGroups.set(e,[t.getSelectedOptions()]),this.selectGroupsValues.set(e,[t.value]))}setDisabledOptions(t){let e=t.getAttribute("data-select-group"),i=this.selectGroups.get(e).concat();for(var s=0;s<i.length;s++)i[s]=i[s]?i[s].value:"";this.alwaysDisabledOptions&&this.alwaysDisabledOptions.length>0?t.setDisabledOptions(i.concat(this.alwaysDisabledOptions),!0):t.setDisabledOptions(i,!0)}setEnabledOptions(){this.selects=this.querySelectorAll(".select-has-group"),this.selects.forEach((t=>{t.setEnabledOptions(!0)}))}initJsonPopulators(){var t=this.nativeElement.querySelectorAll("div[json-path]");t.forEach((e=>{this.loadJson(e.getAttribute("json-path"),e.id,e.getAttribute("value"),t.length)})),t.length<=0&&this.hasWatchdog&&this.initFormWatchdog()}loadJson(t,e,i,s){fetch(t).then((t=>t.json())).then((t=>this.initJsonSelect(t,e,i,s)))}initRegularSelects(){let t=Object.assign({ele:"select",additionalClasses:"regular-select"},this.virtualSelectConf);VirtualSelect.init(t)}initJsonSelect(t,e,i,s){let a=Object.assign({ele:"#"+e,options:t,selectedValue:i.replace(/ /g,"").split(",")},this.virtualSelectConf);VirtualSelect.init(a),++this.jsonPopulatesIndex==s&&this.hasWatchdog&&(this.watchdogEnabled=!0,this.initFormWatchdog())}initFormWatchdog(){var t=this.nativeElement;this.formEls=t.querySelectorAll('input:not([type="submit"]):not(.vscomp-search-input):not(#dseHidden):not(.radioimage-radio), textarea, select, .radioimages'),this.formEls.forEach((t=>{"input"===t.tagName.toLowerCase()&&"checkbox"===t.getAttribute("type")?this.formsMap.set(t.getAttribute("name"),t.checked):t.hasAttribute("original-data")?this.formsMap.set(t.getAttribute("name"),t.getAttribute("original-data")):t.value?this.formsMap.set(t.getAttribute("name"),t.value):this.formsMap.set(t.getAttribute("name"),t.getAttribute("value")),t.fieldValid=function(){var t="neutral";let e=document.querySelector('label[for="'+this.name+'"]');if(e)if(e.classList.contains("is-required")&&""==this.value)t="error";else if(""!=this.value)t="valid";return t},this.setElementCheck(this.nativeElement,t);let e=this.nativeElement.querySelector("#"+t.getAttribute("name"));"DIV"==e.tagName?e.addEventListener("change",function(t){let e=t.target.querySelector("input");t.currentTarget.classList.contains("radioimages")&&(e=t.currentTarget,t.currentTarget.resetRadioGroup=function(t){this.querySelectorAll("input").forEach((e=>{e.value!=t?e.checked=!1:e.checked=!0}))}),t.target.value!=this.formsMap.get(t.target.getAttribute("name"))?this.setElementChanged(this.nativeElement,e):this.unsetElementChanged(e),this.setElementCheck(this.nativeElement,e)}.bind(this)):e.addEventListener("input",function(t){t.target.value!=this.formsMap.get(t.target.id)?this.setElementChanged(this.nativeElement,t.target):this.unsetElementChanged(t.target),this.setElementCheck(this.nativeElement,t.target)}.bind(this))})),this.formInitialized=!0,this.bindToDOMElement()}setElementCheck(t,e){if(e){let i=t.querySelector("#"+e.getAttribute("name")),s=i.getAttribute("data-ajax-handler");if(i&&s)s&&window[s](i);else{let i=t.querySelector('.checks[data-for="'+e.name+'"]'),s=t.querySelector('.errors[data-for="'+e.name+'"]'),a=t.querySelector("#"+e.name);a&&s&&i&&("valid"==e.fieldValid()?(s.classList.add("d-none"),i.classList.remove("d-none"),a.classList.add("filled")):"error"==e.fieldValid()?(s.classList.remove("d-none"),i.classList.add("d-none"),a.classList.remove("filled")):(s.classList.add("d-none"),i.classList.add("d-none"),a.classList.remove("filled")))}}}setElementChanged(t,e){if(e){let i=t.querySelector("#"+e.getAttribute("name")),s=i.getAttribute("data-change-handler");i&&s&&s&&window[s](i),e.setAttribute("statusChanged",""),this.updateFormStatus()}document.dispatchEvent(new CustomEvent("current_form",{detail:{context:this.nativeElement}}))}unsetElementChanged(t){t&&(t.removeAttribute("statusChanged"),this.updateFormStatus())}updateFormStatus(){let t=!1;this.formEls.forEach((e=>{let i=e.hasAttribute("statusChanged");t=t||i})),this.formChanged=t,this.nativeElement&&(this.nativeElement.formChanged=this.formChanged,this.nativeElement.setAttribute("form_changed",this.formChanged)),this.submit.disabled=!this.formChanged,this.reset&&(this.reset.disabled=!this.formChanged);let e=window.findParentContainer(this.nativeElement?this.nativeElement.parentNode:this.parentNode,"tab-pane");document.dispatchEvent(new CustomEvent("form_changed",{detail:{paneID:e.id,state:this.formChanged}}))}enableForm(){this.formEls.forEach((t=>{let e=this.querySelector("#"+t.getAttribute("name"));e.classList.contains("vscomp-ele")?e.classList.contains("force-disabled")||e.enable():t.classList.contains("force-disabled")||(t.disabled=!1)})),this.formDisabled=!1}disableForm(){this.formEls.forEach((t=>{let e=this.querySelector("#"+t.getAttribute("name"));e.classList.contains("vscomp-ele")?e.classList.contains("force-disabled")||e.disable():e.classList.contains("force-disabled")||(t.disabled=!0)})),this.formDisabled=!0}resetElement(t){"string"==typeof t&&(t=document.querySelector('input[name="'+t+'"'));let e=this.formsMap.get(t.getAttribute("name"));if(t.classList.contains("vscomp-hidden-input")){t.form.querySelector("#"+t.getAttribute("name")).setValue(e.split(","),!0)}else t.classList.contains("radioimages")?(t.value=e,t.resetRadioGroup(e)):"input"===this.tagName.toLowerCase()&&"checkbox"===t.getAttribute("type")?t.checked=e:t.value=e;this.setElementCheck(this,t),t.removeAttribute("statusChanged"),this.updateFormStatus()}resetToDefault(){this.formChanged&&(this.selectGroups=new Map,this.selectGroupsValues=new Map,this.setEnabledOptions(),this.formEls.forEach((t=>{this.resetElement(t)})),this.formChanged=!1,this.setAttribute("form_changed",!1),this.submit.disabled=!0,this.reset&&(this.reset.disabled=!0));let t=window.findParentContainer(this.parentNode,"tab-pane");document.dispatchEvent(new CustomEvent("form_changed",{detail:{paneID:t.id,state:this.formChanged}}))}bindToDOMElement(){this.nativeElement.resetToDefault=this.resetToDefault,this.nativeElement.initSelectGroupWatchdog=this.initSelectGroupWatchdog,this.nativeElement.setSelectedOptions=this.setSelectedOptions,this.nativeElement.setDisabledOptions=this.setDisabledOptions,this.nativeElement.setEnabledOptions=this.setEnabledOptions,this.nativeElement.onSelectChange=this.onSelectChange,this.nativeElement.setElementCheck=this.setElementCheck,this.nativeElement.disableForm=this.disableForm,this.nativeElement.enableForm=this.enableForm,this.nativeElement.resetElement=this.resetElement,this.nativeElement.updateFormStatus=this.updateFormStatus,this.nativeElement.formInitialized=this.formInitialized,this.nativeElement.formDisabled=this.formDisabled,this.nativeElement.selectGroups=this.selectGroups,this.nativeElement.selectGroupsValues=this.selectGroupsValues,this.nativeElement.formEls=this.formEls,this.nativeElement.formsMap=this.formsMap,this.nativeElement.formChanged=this.formChanged,this.nativeElement.submit=this.submit,this.nativeElement.reset=this.reset}}function s(){document.querySelectorAll(".watchdog__form").forEach((t=>{t=new i(t)})),document.addEventListener("current_form",(t=>{a=t.detail.context}),!0),document.addEventListener("keydown",(function(t){(window.navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&83==t.keyCode&&(t.preventDefault(),a&&"true"==a.getAttribute("form_changed")&&sendAjaxForm(a.id))}),!1),document.addEventListener("form_changed",(t=>{let e=t.detail.state,i=t.detail.paneID,s=document.querySelector('button[aria-controls="'+i+'"]');e?s.classList.add("unsaved"):s.classList.remove("unsaved")}),!0),n=document.querySelectorAll(".pin__form"),n.forEach((t=>{let e=t.querySelectorAll(".field__pin"),i=t.classList.contains("autofocus");e.forEach(((t,s)=>{i&&e[0].focus(),t.addEventListener("keyup",(function(i){8!=i.keyCode&&"Backspace"!==i.key&&"Delete"!==i.key&&37!=i.keyCode?(t.value||39==i.keyCode)&&(s===e.length-1?this.form.querySelector('input[type="submit"]').focus():(e[s+1].focus(),e[s+1].select())):s>0&&(e[s-1].focus(),e[s-1].select())}))}))})),document.querySelectorAll(".upload-form").forEach((t=>{new e(t)}))}let a,n;function l(t){t.querySelectorAll("form.dynamic-content.watchdog__form").forEach((t=>{t.initSelectGroupWatchdog()}))}function o(t){t.querySelectorAll("form.watchdog__form").forEach((t=>{t.resetToDefault()}))}const r=document.querySelector("#cross-data").getAttribute("page-slug");function c(){console.log("init admin"),s(),function(){console.log("init bs"),document.addEventListener("done_fetching_information",p,!0),document.querySelectorAll('button[data-bs-toggle="tab"]').forEach((t=>{t.addEventListener("shown.bs.tab",(async function(t){let e;const i=this.getAttribute("data-bs-target");e="#home"==i?d.split("#")[0]:d.split("#")[0]+i,document.querySelectorAll("form").forEach((t=>{t.setAttribute("action",e)})),history.replaceState(null,null,e);let s=t.target.getAttribute("data-bs-target"),a=document.querySelector(s);"pane-exhibition"==a.id&&(fetchDynamicExhibitionData(a),l(a))})),t.addEventListener("hide.bs.tab",(async function(t){let e=t.target.getAttribute("data-bs-target"),i=document.querySelector(e),s=function(t){let e=t.querySelectorAll("form.watchdog__form"),i=0,s=!1;return e.forEach((t=>{t.formChanged&&i++,s=s||t.formChanged})),{changed:i,statusChanged:s}}(i),a=t.relatedTarget.getAttribute("data-bs-target");s.statusChanged?(t.preventDefault(),v({headline:"Achtung",message:"Einige Änderungen wurden nicht gespeichert. Änderungen verwerfen?",func:f,data:a,confirmLabel:"Verwerfen"})):"pane-exhibition"==i.id&&E(i)}))})),document.querySelectorAll(".modal").forEach((t=>{t.addEventListener("hidden.bs.modal",(t=>{o(t.target),E(t.target)})),t.addEventListener("show.bs.modal",(t=>{"confirmationModal"!=t.target.id&&(fetchDynamicExhibitionData(t.target),l(t.target))}))})),g&&g.addEventListener("show.bs.modal",(t=>{const e=t.relatedTarget;let i,s,a,n,l,o,r,c,d,h;e&&(i=e.getAttribute("data-bs-headline"),s=e.getAttribute("data-bs-message"),a=e.getAttribute("data-bs-context"),n=e.getAttribute("data-bs-context-cancel"),l=e.getAttribute("data-bs-func"),o=e.getAttribute("data-bs-func-cancel"),r=e.getAttribute("data-bs-data"),c=e.getAttribute("data-bs-data-cancel"),d=e.getAttribute("data-bs-confirm-label"),h=e.getAttribute("data-bs-cancel-label"));const b=g.querySelector(".modal-title"),f=g.querySelector(".modal-body p"),p=g.querySelector("button.modal-confirm"),E=g.querySelector("button.modal-cancel");i&&(b.textContent=i),s&&(f.innerHTML=s),a&&p.setAttribute("context",a),l&&p.setAttribute("callback",l),r&&p.setAttribute("data",r),n&&E.setAttribute("context-cancel",n),o&&E.setAttribute("callback-cancel",o),c&&E.setAttribute("data-cancel",c),d&&(p.innerHTML=d),h&&(E.innerHTML=h),p.addEventListener("click",u),E.addEventListener("click",m)}));[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((t=>new Tooltip(t,{container:"body",html:!0})))}(),function(){if(d=location.href.replace(/\/$/,""),location.hash){const t=d.split("#");let e=document.querySelector('button[data-bs-target="#'+t[1]+'"]');if(e){new Tab(e).show(),d=location.href.replace(/\/#/,"#"),document.querySelectorAll("form").forEach((t=>{t.setAttribute("action",d)})),history.replaceState(null,null,d)}setTimeout((()=>{window.scrollTo(0,0)}),100)}}()}let d,h;function u(t){let e=t.target,i=document.querySelector(e.getAttribute("context"))??window;b(e.getAttribute("callback"),i,e.getAttribute("data")),h.hide()}function m(t){let e=t.target,i=document.querySelector(e.getAttribute("context-cancel"))??window;b(e.getAttribute("callback-cancel"),i,e.getAttribute("data-cancel")),h.hide()}function b(t,e,i){i=Array.prototype.slice.call(arguments,2);for(var s=t.split("."),a=s.pop(),n=0;n<s.length;n++)e=e[s[n]];return e[a].apply(e,i)}Object.assign(window,{initAdmin:c}),Object.assign(window,{resetFormModal:function(t){let e=document.querySelector('button[data-bs-toggle="tab"].active').getAttribute("data-bs-target");o(document.querySelector(e))}}),Object.assign(window,{handleChangedFormModal:function(t){let e=document.querySelector('button[data-bs-toggle="tab"].active').getAttribute("data-bs-target");o(document.querySelector(e));let i=document.querySelector('button[data-bs-target="'+t+'"]');new Tab(i).show()}});let g=document.getElementById("confirmationModal");g&&(h=new Modal("#confirmationModal"));const f="handleChangedFormModal";async function p(t){dynamicInit();if([...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((t=>new Tooltip(t,{container:"body"}))),t.target&&(t=t.detail.context),!t.classList.contains("user-removed")){const e=t.getAttribute("data-pageid");if(e){let i=location.protocol+"//"+location.host+location.pathname+".json?lockMe="+e;console.log(i);try{const e=await fetch(i),{lockactionstatus:s,lockedBy:a,overlayCode:n}=await e.json();if("already_locked"==s){t.querySelectorAll("form.watchdog__form").forEach((t=>{t.disableForm()})),t.setAttribute("blocked-by",a),t.classList.add("blocked"),t.querySelector(".overlay_container").innerHTML=n}else{!function(t){t.querySelectorAll("form.watchdog__form").forEach((t=>{t.formInitialized&&t.enableForm()}))}(t),t.setAttribute("blocked-by",r),t.classList.remove("blocked");let e=t.querySelector(".overlay_container");e&&(e.innerHTML="")}}catch(t){console.log("Fetch error: ",t)}}}}async function E(t){const e=t.getAttribute("data-pageid");if(e){let i=t.getAttribute("blocked-by"),s=null!=i?"&blockedBy="+i:"",a=location.protocol+"//"+location.host+location.pathname+".json?unlockMe="+e+s;console.log(a);try{const e=await fetch(a),{lockactionstatus:i,lockedBy:s}=await e.json();"was_already_locked"==i||r!=s&&s||t.setAttribute("blocked-by","")}catch(t){console.log("Fetch error: ",t)}}}function v(t){let e=document.createElement("button");e.setAttribute("data-bs-headline",t.headline??""),e.setAttribute("data-bs-message",t.message??""),e.setAttribute("data-bs-context",t.context??""),e.setAttribute("data-bs-func",t.func??""),e.setAttribute("data-bs-data",t.data??""),e.setAttribute("data-bs-context-cancel",t.contextCancel??""),e.setAttribute("data-bs-func-cancel",t.funcCancel??""),e.setAttribute("data-bs-data-cancel",t.dataCancel??""),e.setAttribute("data-bs-confirm-label",t.confirmLabel??"Bestätigen"),e.setAttribute("data-bs-cancel-label",t.cancelLabel??"Abbrechen"),h.show(e)}Object.assign(window,{createPhantomToggle:v}),c()}));
//# sourceMappingURL=admin.js.map