!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";class e{constructor(e,t=!0){this.formInitialized=!1,this.formDisabled=!1,this.nativeElement=e,this.submit=this.nativeElement.querySelector('button[type="submit"]'),this.reset=this.nativeElement.querySelector('button.btn-reset[type="button"]'),this.hasWatchdog=t,this.formChanged=!1,this.jsonPopulatesIndex=0,this.formsMap=new Map,this.selectGroups=new Map,this.selectGroupsValues=new Map,this.selects=[],this.alwaysDisabledOptions=[],this.formEls,this.virtualSelectConf={placeholder:"Bitte wählen",noOptionsText:"Keine Optionen",noSearchResultsText:"Keine Ergebnisse",searchPlaceholderText:"Suchen...",allOptionsSelectedText:"Alle",optionsSelectedText:"ausgewählt",optionSelectedText:"ausgewählt",moreText:"mehr...",emptyValue:"",search:!0,disableSelectAll:!0,silentInitialValueSet:!0,autoSelectFirstOption:!1,disableOptionGroupCheckbox:!0},this.init()}init(){this.submit.disabled=!0,this.reset&&(this.reset.disabled=!0),this.initRegularSelects(),this.initJsonPopulators(),this.selects=this.nativeElement.querySelectorAll(".select-has-group"),this.selects.forEach((e=>{e.addEventListener("change",this.onSelectChange.bind(this.nativeElement))})),this.nativeElement.selects=this.selects,this.nativeElement.virtualSelectConf=this.virtualSelectConf}initSelectGroupWatchdog(){console.log("init form groups"),this.selects.forEach((e=>{this.setSelectedOptions(e)})),this.selects.forEach((e=>{e.permaDisabledOptions=[];let t=e.getDisabledOptions(),s=e.getAttribute("data-select-group"),i=this.selectGroupsValues.get(s);t.forEach((t=>{i.indexOf(t)<0&&e.permaDisabledOptions.push(t)})),this.alwaysDisabledOptions=e.permaDisabledOptions}))}onSelectChange(e){let t=e.target.getAttribute("data-select-group");this.selectGroups.set(t,""),this.selects.forEach((e=>{this.setSelectedOptions(e)})),this.selects.forEach((e=>{this.setDisabledOptions(e)}))}setSelectedOptions(e){let t=e.getAttribute("data-select-group"),s=this.selectGroups.get(t),i=this.selectGroupsValues.get(t);s&&s.length>0?(this.selectGroups.set(t,s.concat([e.getSelectedOptions()])),this.selectGroupsValues.set(t,i.concat([e.value]))):(this.selectGroups.set(t,[e.getSelectedOptions()]),this.selectGroupsValues.set(t,[e.value]))}setDisabledOptions(e){let t=e.getAttribute("data-select-group"),s=this.selectGroups.get(t).concat();for(var i=0;i<s.length;i++)s[i]=s[i]?s[i].value:"";this.alwaysDisabledOptions&&this.alwaysDisabledOptions.length>0?e.setDisabledOptions(s.concat(this.alwaysDisabledOptions),!0):e.setDisabledOptions(s,!0)}setEnabledOptions(){this.selects=this.querySelectorAll(".select-has-group"),this.selects.forEach((e=>{e.setEnabledOptions(!0)}))}initJsonPopulators(){var e=this.nativeElement.querySelectorAll("div[json-path]");e.forEach((t=>{this.loadJson(t.getAttribute("json-path"),t.id,t.getAttribute("value"),e.length)})),e.length<=0&&this.hasWatchdog&&this.initFormWatchdog()}loadJson(e,t,s,i){fetch(e).then((e=>e.json())).then((e=>this.initJsonSelect(e,t,s,i)))}initRegularSelects(){let e=Object.assign({ele:"select",additionalClasses:"regular-select"},this.virtualSelectConf);VirtualSelect.init(e)}initJsonSelect(e,t,s,i){let a=Object.assign({ele:"#"+t,options:e,selectedValue:s.replace(/ /g,"").split(",")},this.virtualSelectConf);VirtualSelect.init(a),++this.jsonPopulatesIndex==i&&this.hasWatchdog&&(this.watchdogEnabled=!0,this.initFormWatchdog())}initFormWatchdog(){var e=this.nativeElement;this.formEls=e.querySelectorAll('input:not([type="submit"]):not(.vscomp-search-input):not(#dseHidden):not(.radioimage-radio), textarea, select, .radioimages'),this.formEls.forEach((e=>{"input"===e.tagName.toLowerCase()&&"checkbox"===e.getAttribute("type")?this.formsMap.set(e.getAttribute("name"),e.checked):e.hasAttribute("original-data")?this.formsMap.set(e.getAttribute("name"),e.getAttribute("original-data")):e.value?this.formsMap.set(e.getAttribute("name"),e.value):this.formsMap.set(e.getAttribute("name"),e.getAttribute("value")),e.fieldValid=function(){var e="neutral";let t=document.querySelector('label[for="'+this.name+'"]');if(t)if(t.classList.contains("is-required")&&""==this.value)e="error";else if(""!=this.value)e="valid";return e},this.setElementCheck(this.nativeElement,e);let t=this.nativeElement.querySelector("#"+e.getAttribute("name"));"DIV"==t.tagName?t.addEventListener("change",function(e){let t=e.target.querySelector("input");e.currentTarget.classList.contains("radioimages")&&(t=e.currentTarget,e.currentTarget.resetRadioGroup=function(e){this.querySelectorAll("input").forEach((t=>{t.value!=e?t.checked=!1:t.checked=!0}))}),e.target.value!=this.formsMap.get(e.target.getAttribute("name"))?this.setElementChanged(this.nativeElement,t):this.unsetElementChanged(t),this.setElementCheck(this.nativeElement,t)}.bind(this)):t.addEventListener("input",function(e){e.target.value!=this.formsMap.get(e.target.id)?this.setElementChanged(this.nativeElement,e.target):this.unsetElementChanged(e.target),this.setElementCheck(this.nativeElement,e.target)}.bind(this))})),this.formInitialized=!0,this.bindToDOMElement()}setElementCheck(e,t){if(t){let s=e.querySelector("#"+t.getAttribute("name")),i=s.getAttribute("data-ajax-handler");if(s&&i)i&&window[i](s);else{let s=e.querySelector('.checks[data-for="'+t.name+'"]'),i=e.querySelector('.errors[data-for="'+t.name+'"]'),a=e.querySelector("#"+t.name);a&&i&&s&&("valid"==t.fieldValid()?(i.classList.add("d-none"),s.classList.remove("d-none"),a.classList.add("filled")):"error"==t.fieldValid()?(i.classList.remove("d-none"),s.classList.add("d-none"),a.classList.remove("filled")):(i.classList.add("d-none"),s.classList.add("d-none"),a.classList.remove("filled")))}}}setElementChanged(e,t){if(t){let s=e.querySelector("#"+t.getAttribute("name")),i=s.getAttribute("data-change-handler");s&&i&&i&&window[i](s),t.setAttribute("statusChanged",""),this.updateFormStatus()}document.dispatchEvent(new CustomEvent("current_form",{detail:{context:this.nativeElement}}))}unsetElementChanged(e){e&&(e.removeAttribute("statusChanged"),this.updateFormStatus())}updateFormStatus(){let e=!1;this.formEls.forEach((t=>{let s=t.hasAttribute("statusChanged");e=e||s})),this.formChanged=e,this.nativeElement&&(this.nativeElement.formChanged=this.formChanged,this.nativeElement.setAttribute("form_changed",this.formChanged)),this.submit.disabled=!this.formChanged,this.reset&&(this.reset.disabled=!this.formChanged);let t=window.findParentContainer(this.nativeElement?this.nativeElement.parentNode:this.parentNode,"tab-pane");document.dispatchEvent(new CustomEvent("form_changed",{detail:{paneID:t.id,state:this.formChanged}}))}enableForm(){this.formEls.forEach((e=>{let t=this.querySelector("#"+e.getAttribute("name"));t.classList.contains("vscomp-ele")?t.classList.contains("force-disabled")||t.enable():e.classList.contains("force-disabled")||(e.disabled=!1)})),this.formDisabled=!1}disableForm(){this.formEls.forEach((e=>{let t=this.querySelector("#"+e.getAttribute("name"));t.classList.contains("vscomp-ele")?t.classList.contains("force-disabled")||t.disable():t.classList.contains("force-disabled")||(e.disabled=!0)})),this.formDisabled=!0}resetElement(e){"string"==typeof e&&(e=document.querySelector('input[name="'+e+'"'));let t=this.formsMap.get(e.getAttribute("name"));if(e.classList.contains("vscomp-hidden-input")){e.form.querySelector("#"+e.getAttribute("name")).setValue(t.split(","),!0)}else e.classList.contains("radioimages")?(e.value=t,e.resetRadioGroup(t)):"input"===this.tagName.toLowerCase()&&"checkbox"===e.getAttribute("type")?e.checked=t:e.value=t;this.setElementCheck(this,e),e.removeAttribute("statusChanged"),this.updateFormStatus()}resetToDefault(){this.formChanged&&(this.selectGroups=new Map,this.selectGroupsValues=new Map,this.setEnabledOptions(),this.formEls.forEach((e=>{this.resetElement(e)})),this.formChanged=!1,this.setAttribute("form_changed",!1),this.submit.disabled=!0,this.reset&&(this.reset.disabled=!0));let e=window.findParentContainer(this.parentNode,"tab-pane");document.dispatchEvent(new CustomEvent("form_changed",{detail:{paneID:e.id,state:this.formChanged}}))}bindToDOMElement(){this.nativeElement.resetToDefault=this.resetToDefault,this.nativeElement.initSelectGroupWatchdog=this.initSelectGroupWatchdog,this.nativeElement.setSelectedOptions=this.setSelectedOptions,this.nativeElement.setDisabledOptions=this.setDisabledOptions,this.nativeElement.setEnabledOptions=this.setEnabledOptions,this.nativeElement.onSelectChange=this.onSelectChange,this.nativeElement.setElementCheck=this.setElementCheck,this.nativeElement.disableForm=this.disableForm,this.nativeElement.enableForm=this.enableForm,this.nativeElement.resetElement=this.resetElement,this.nativeElement.updateFormStatus=this.updateFormStatus,this.nativeElement.formInitialized=this.formInitialized,this.nativeElement.formDisabled=this.formDisabled,this.nativeElement.selectGroups=this.selectGroups,this.nativeElement.selectGroupsValues=this.selectGroupsValues,this.nativeElement.formEls=this.formEls,this.nativeElement.formsMap=this.formsMap,this.nativeElement.formChanged=this.formChanged,this.nativeElement.submit=this.submit,this.nativeElement.reset=this.reset}}async function t(e){let t=!1;if(e)try{console.log("fetch:: "+e);const s=await fetch(e),{embed:i}=await s.json();t=i,console.log(t)}catch(e){console.log("Fetch error: ",e)}return t}Object.assign(window,{sendAjaxForm:function(e){let t=document.getElementById(e),s=t.querySelector('button[type="submit"]');s?s.click():t.submit()}}),Object.assign(window,{checkImpulseRelationships:async function(e){let t=e.value,s=e.form.parentElement.getAttribute("data-pageid");if(!s)return;let i=location.protocol+"//"+location.host+location.pathname;i=`${i}.json/?impulseCheck=${t}&pageID=${s}`;try{const s=await fetch(i),{impulseResult:a}=await s.json();let r=e.form.querySelector('.checks[data-for="'+e.id+'"]'),l=e.form.querySelector('.errors[data-for="'+e.id+'"]'),c=e.form.querySelector('.warnings[data-for="'+e.id+'"]'),d=e.form.querySelector("#"+e.id);"result_success"==a?d&&l&&r&&c&&(n(d,r,l),c.classList.add("d-none")):"result_warning"==a?d&&l&&r&&c&&(l.classList.add("d-none"),c.classList.remove("d-none"),r.classList.add("d-none"),d.classList.remove("filled")):"result_error"==a?d&&l&&r&&c&&(o(d,r,l),c.classList.add("d-none")):""!=t?(c.classList.add("d-none"),n(d,r,l)):(c.classList.add("d-none"),o(d,r,l))}catch(e){console.log("Fetch error: ",e)}}}),Object.assign(window,{checkImpulseRelationshipsList:async function(e){let t=e.value,s=e.form.parentElement;for(;!s.classList.contains("modal")&&!s.classList.contains("tab-pane");)s=s.parentElement;let i=s.getAttribute("data-pageid");if(!i)return;let a=location.protocol+"//"+location.host+location.pathname;a=`${a}.json/?curatorID=${t}&exhibitionID=${i}`;try{const t=await fetch(a),{impulseResult:s}=await t.json();let i=e.form.querySelector('.checks[data-for="'+e.id+'"]'),r=e.form.querySelector('.errors[data-for="'+e.id+'"]'),l=e.form.querySelector('.warnings[data-for="'+e.id+'"]'),c=e.form.querySelector("#"+e.id);"result_success"==s?c&&r&&i&&l&&(n(c,i,r),l.classList.add("d-none")):"result_warning"==s?c&&r&&i&&l&&(r.classList.add("d-none"),l.classList.remove("d-none"),i.classList.add("d-none"),c.classList.remove("filled")):"result_error"==s?c&&r&&i&&l&&(o(c,i,r),l.classList.add("d-none")):c&&r&&i&&l&&(r.classList.add("d-none"),i.classList.add("d-none"),l.classList.add("d-none"),c.classList.remove("filled"))}catch(e){console.log("Fetch error: ",e)}}}),Object.assign(window,{fetchDynamicExhibitionData:async function(t){if("pane-exhibition"==t.id||t.classList.contains("modal")){let s=t.getAttribute("data-pageid"),i=location.protocol+"//"+location.host+location.pathname;i=`${i}.json/?exhibitionpage=${s}`,console.log(i);try{const s=await fetch(i),{isCuratorLeader:a,exhibitionDataResult:n,curatorInExhibition:o}=await s.json();if(a||n&&o){let s=t.querySelector("form");s.querySelector(".dynamic__content").innerHTML=n,s=new e(s)}else t.classList.add("user-removed"),t.innerHTML="Sie wurden angeblich von den Ausstellungen entfernt. Bitte Fenster neu laden.";document.dispatchEvent(new CustomEvent("done_fetching_information",{detail:{context:t}}))}catch(e){console.log("Fetch error: ",e)}}}}),Object.assign(window,{scrapEmbed:t}),Object.assign(window,{scrapFreshEmbedImage:async function(e){let s;return await t(e).then((e=>{s=e.data?{imgTag:'<img src="'+e.data.image+'" alt="'+e.data.title+'">',imgWidth:e.data.imageWidth,imgHeight:e.data.imageHeight}:{imgTag:'<p class="single-exhibit text-danger">Unable to load<span class="empty"><i icon-name="x-circle" class="icon-only"></i></span></p>'}})),s}}),Object.assign(window,{scrapWorkshopEmbed:function(e){let s=e.value;s=s.split("?")[0].replace(/\/$/,""),e.value=s;let i=location.protocol+"//"+location.host+location.pathname;i=`${i}.json/?embedurl=${s}`;let a=document.getElementById("embed__preview");if(s&&a)t(i).then((t=>{let s=e.form.querySelector('.checks[data-for="'+e.id+'"]'),i=e.form.querySelector('.errors[data-for="'+e.id+'"]'),r=e.form.querySelector("#"+e.id);if(t.data){if(r&&i&&s&&n(r,s,i),a.innerHTML=t.data.code,a.setAttribute("class","mx-auto "+t.data.providerName.toLowerCase()),window.twttr)window.twttr.widgets.load();else if("twitter"==t.data.providerName.toLowerCase()){const e=document.createElement("script");e.src="https://platform.twitter.com/widgets.js",document.body.appendChild(e)}if(window.instgrm)window.instgrm.Embeds.process();else if("instagram"==t.data.providerName.toLowerCase()){const e=document.createElement("script");e.src="https://www.instagram.com/embed.js",document.body.appendChild(e)}if("tiktok"==t.data.providerName.toLowerCase()){const e=document.createElement("script");e.src="https://www.tiktok.com/embed.js",document.body.appendChild(e)}}else{document.querySelector("#embed__preview").innerHTML="<p>Es ist ein Fehler aufgetreten oder der Link ist ungültig und konnte nicht geladen werden.</p>",r&&i&&s&&o(r,s,i)}}));else{let t=e.form.querySelector('.checks[data-for="'+e.id+'"]'),s=e.form.querySelector('.errors[data-for="'+e.id+'"]'),i=e.form.querySelector("#"+e.id);i&&s&&t&&(s.classList.remove("d-none"),t.classList.add("d-none"),i.classList.remove("filled"))}}}),Object.assign(window,{fileUpload:function(e){var t=e.currentTarget,s=t.form,i=s.querySelector(".progress-bar"),a=s.querySelector(".files");let n=location.protocol+"//"+location.host+location.pathname+".json";var o=a.files[0],r=new FormData;r.append(a.id,o),r.set(t.name,t.name);var l=new XMLHttpRequest;l.responseType="json",l.open("POST",n,!0),l.upload.onprogress=function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);i.style.width=t+"%",i.innerHTML=t+"%",i.setAttribute("aria-valuenow",t)}else console.log("Unable to compute progress information since the total size is unknown")},l.onload=function(e){4==this.readyState&&200==this.status&&(sessionStorage.setItem("alert",this.response.alert),location.reload())},l.send(r)}}),Object.assign(window,{checkRadioGroupGallery:function(e){var t=document.getElementsByName(e.id),s=Array.prototype.slice.call(t),i=(s=s.filter((function(e){return"DIV"!==e.tagName})))[0],a=s.find((e=>e.checked));let r=i.form.querySelector('.checks[data-for="'+e.id+'"]'),l=i.form.querySelector('.errors[data-for="'+e.id+'"]'),c=e;a?(c.setAttribute("value",a.value),""==a.value?o(c,r,l):n(c,r,l)):(i.checked=!0,o(c,r,l))}});var s=document.querySelector("input#username");let i,a=300;function n(e,t,s){t.classList.remove("d-none"),s.classList.add("d-none"),e.classList.add("filled")}function o(e,t,s){t.classList.add("d-none"),s.classList.remove("d-none"),e.classList.remove("filled")}Object.assign(window,{checkUsername:function(e){const t=e.form;let r=t.querySelector('.checks[data-for="'+e.name+'"]'),l=t.querySelector('.errors[data-for="'+e.name+'"]');clearTimeout(i),s.form.hasAttribute("user-error")?(o(e,r,l),s.form.removeAttribute("user-error")):""!=e.value?i=setTimeout(async function(){if(null!=e.getAttribute("statuschanged")){let t=location.protocol+"//"+location.host+location.pathname+".json?username="+e.value;try{const s=await fetch(t),{usernameExists:i}=await s.json();i?(console.log("user-exists"),o(e,r,l)):n(e,r,l),e.removeAttribute("first-run-username")}catch(e){console.log("Fetch error: ",e)}}else n(e,r,l)}.bind(e),a):o(e,r,l)}}),Object.assign(window,{handleExhibitTypeChange:function(e){let t=e.form;createPhantomToggle({headline:"Achtung",message:"Wenn Sie den Objekttyp verändern wird das Objekt gespeichert und manche Daten werden zurückgesetzt. Sind Sie sicher?",func:"sendAjaxForm",data:t.id,contextCancel:"#"+t.id,funcCancel:"resetElement",dataCancel:e.id,confirmLabel:"Ja, ändern"})}})}));
//# sourceMappingURL=ajax-functions.js.map